<!DOCTYPE html>
<html lang="hu">
<head>
  <title>borospince</title>
  <meta name="description" content="Deszkamodell. Az elektronikus eszközök fejlesztésének olyan állapota, amiben az egymással összekapcsolt alkatrészek teszik a dolgukat, de ebben a kivitelben még nem érett kereskedelmi forgalmazásra, viszont könnyen alakítható a műszaki tartalom.">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/borok/styles_cs2020.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
  <link rel="icon" href="/src_home/favicon.ico" type="image/x-icon">
</head>
<style>
  li,li::marker {
    font-size: x-large;
  }
</style>
<body>
  <div class="active-footer">
    <a onclick="window.scrollTo(0,0);"><span class="back-to-top"><span class="material-icons-outlined">&#xe5ce;</span></span></a>
  </div>
  <section id="container_cs2020">
    <div class="nav-wrapper">
      <div id="hamburger" class="nav-link-wrapper material-icons-outlined">&#xe5d2;</div>
      <div class="left-side">
        <div id="bigyo">
          <div id="balmenu">
            <div class="nav-link-wrapper">
              <a href="/index.html"><span class="material-icons-outlined">&#xe88a;</span></a>
            </div>
            <button id="kjelzo"></button><br>
            <button id="holtart"></button><br>
            <button class="tlan" id="naptar"></button>
          </div>
        </div>
        <select name="olv"></select>
      </div>
    </div>
    <div class="content">
      <div class="box-text">
        <p style="z-index:1"><a name="elozo"></a></p>
      </div>
      <h1>Deszkamodell</h1>
      <div class="box">
        <div class="box-text">
          <p>
            Nem, ez nem egy anorexiás, csontos csípőjét kifutókon riszáló, a legújabb divatot diktálni hivatott öltözéket bemutató fiatal lány, hanem a mérnöki munka egyik lépcsőfoka.
            Az elektronikus eszközök fejlesztésének olyan állapota, amiben az egymással összekapcsolt alkatrészek teszik a dolgukat, de ebben a kivitelben még nem érett kereskedelmi forgalmazásra,
            viszont könnyen alakítható a műszaki tartalom. Felöltöztetni ráérek akkor, amikor az eszköz kívánt működését sikerült megvalósítani.
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka.webp">
          </div>
          <p>⚠️Ebből a beszámolóból legfeljebb ötleteket és ösztönzést kaphatsz, nem a kész megoldás komplett dokumentációját.</p>
        </div>
      </div>
      <div class="box">
        <div class="box-text">
          <p>
            A divatbemutatók deszkamodellje burkolat nélkül igen ocsmány formát mutat. Sokat dob megjelenésén a ruha, mert eltakarja kiálló bordáit, girhes testét.
            Egy elektronikai eszköz deszkamodellje kifogástalanul működhet csomagolás nélkül, legfeljebb az időjárás hatásai vagy a por ellen indokolt biztosítani védelmét.
            Némely portéka izgalmasabb látványt nyújt könnyített burkolattal, akár egy jó testi adottságú nő csipkésbugyiban. Létezik olyan perverzió,
            ami csupasz elektronikai eszközök működés közbeni látványával elégíthető ki, és ennek az igénynek tesz eleget például az <a href="http://www.tubes4hifi.com/ST70.htm">ST-70</a> elektroncsöves erősítő.
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-st-70-a.webp">
          </div>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-st-70-b.webp">
          </div>
        </div>
        <div id="2016-04-27" alcim="működő prototípus felszerelve" class="box-text">
          <p>
            Villannyal működő szerkezetnél a készülékház hiánya érintésvédelmi szempontból súlyos gondot okozhat, hiszen a szabadon álló alkatrészek felforrósodhatnak és rázhatnak.
            Ahogy a bukósisak nélküli motorozás szerelmesei is tudják, mit kockáztatnak, úgy a burkolat nélküli elektromos eszközt használók is veszélyt vállalnak.
            5 voltról működő számítógépes rendszerekben szerencsére nem fenyeget áramütés veszélye, ezért bátran lógattam fel a garázsban az <i>okoskapu</i> vezérlésének pőre deszkamodelljét.
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka2.webp">
          </div>
          <p>
            Okoskapu? Az meg minek egy erdőszéli háztartásba? A kapumozgató motor gyári vezérlése jól végzi dolgát addig, amíg egy rendkívüli esemény be nem következik. Ilyenkor a kapu megáll, és gazdájának beavatkozására vár.
            Mi számít rendkívülinek egy garázsban, ami kihat a kapu működésére? Például eldőlhet egy falnak támasztott seprű, ami a kapu alá kerülve megakadályozza annak becsukódását.
            A kapu az akadályt észlelve megáll, majd visszanyílik kb. fél métert, és nem mozdul addig, amíg valaki nem intézkedik. Észszerű működés. Ha valami a csukódó kapu alá szorulna, így könnyű kiszabadítani.
            <br>
            Akik sietősen távoznak otthonról, és nem várják végig a kapu záródását, azok hazatérvén szembesülhetnek a kínos helyzettel, hogy távollétük alatt a garázskapu mindvégig nyitva volt.
            Egy ilyen helyzet nem csupán kínos, hanem a vagyonbiztonság ellen is vét, különösen utcafronti garázs esetében. Csak az nem kúszik be a nyíláson, aki nem akar. Akiben pedig megvan erre a hajlam, az távozóban rendszerint magával viszi az értékesebb vagyontárgyakat.
            Nem csak a garázsban lévő dolgok vannak veszélyben, mert a behatoló akár az egész házat kirámolhatja, ha oda a garázsból be lehet jutni. Érdemes tehát türelmesen megvárni, amíg a kapu teljesen becsukódik.
            Belátni az előnyét egy javaslatnak nem úgy hat, mint megfogadni. Velem együtt a nagy többség meddőnek tartja a várakozással töltött időt, mint ahogy egy kedves ismerősöm is, aki nálam kevésbé szerencsés.
            Ő rendszeresen ér haza arra, hogy utcafronti garázsa nem csukódott be teljesen, és ilyenkor szélütés kerülgeti.
          </p>
        </div>
        <div class="box-text">
          <p>
            Ezt a szerencsétlen flótást nem csak türelmetlenség jellemzi, hanem egyben tájékozott ember is.
            Ismeri a technikai lehetőségeket és engem is, ebből arra a következtetésre jutott, hogy felkérésére szállítom neki a műszaki megodást arra,
            hogy továbbra is fegyelmezetlenül elszáguldhasson otthonról, de kapjon értesítést, ha a garázskapu valamiért nem csukódna be az elvárásnak megfelelően.
            Okostelefonnal szaladgálva a 4G/LTE világában ez nem valóságtól elrugaszkodott vágy, ezért foglalkozni kezdek a feladat megoldásával.
            <br><br>
            <b>1. kutatás</b>
            <br>
            Árul ilyet valaki? Igen, többen is. Íme néhány találat:
          </p>
          <ul>
            <li><a href="https://www.gogogate.com/">GoGogate</a> 154€ + ÁFA</li>
            <li><a href="https://garageio.com/">Garageio</a> 199$ + ÁFA</li>
            <li><a href="http://www.insteon.com/garage-door-control-kit/">Insteon I/O Linc + HUB</a> 160$ + ÁFA</li>
            <li><a href="http://www.hormann.hu/news/bisecur-gateway-okostelefon-alkalmazas/">Hörmann Bisecur GW + HET-E2</a> ~105.000 Ft</li>
          </ul>
          <p>
            Továbbá találni az interneten <a href="http://www.postscapes.com/wifi-garage-door-opener/">tematikus weboldalt</a>, ahol csokorba szednek egy csomó, garázskapu távvezérléshez készített terméket.
            Ezek között akadnak profi- és barkácsmegoldások egyaránt, melyek közös jellemzője, hogy elsősorban a kapu nyitására-zárására összpontosítanak, miközben az állapotjelzést félvállról veszik.
            Ez az egyik oka annak, hogy a késztermékként megvásárolható eszközök egyike sem tesz pontot az ügy végére, emellett az áruk sem teszi vonzóvá őket.
            Egyik sem olcsó, de mindegyik piszok drága - a közép-kelet-európai sovány pénztárcához mérten persze, mert a fizetendő összegen a nálunk szerencsésebb történelmi fejlődésű országok polgárai nem rökönyödnek meg.
            A kutatás eredménye: senki nem kínál speciális igényünket kiszolgáló eszközt. Kielégítő és kedvező árú megoldást költségtakarékos alkatrészekre épített saját fejlesztés hozhat.
            <br><br>
            <b>2. alkatrészigény</b>
            <br>
            Mindenekelőtt a kapu helyzetének pontos és megbízható mérésére kell eszközt találnom. Nem elégedhetek meg holmi végálláskapcsolókkal, esetleg dőlésérzékelővel, mert ezek a közbülső helyzetről nem tájékoztatnak. Elvetettem az ultrahangos távolságmérést,
            és a kapura festett vonalkódszerű jelekből nyert adatok kiértékelését, és még jó néhány földöntúli elképzelést. Az első életképes ötletnek a kaput ellensúlyozó rugós tengely forgásának vizsgálata tűnt, ami egy <a href="https://en.wikipedia.org/wiki/Rotary_encoder">rotary encoder</a> (a továbbiakban jeladó) alkalmazásával megoldható.
          </p>
        </div>
        <div class="box-text-update">
          <p>
            Magyar megfelelője még nem csontosodott bele a köznyelvbe, ritkán kerül szóba. Akik már belefutottak, és jószándékkal fordítását igyekeztek adni az eredetinek, azok a következő magyar változatait szülték a <i>rotary encoder</i> kifejezésnek:
          </p>
          <ul>
            <li>elfordulás-érzékelő</li>
            <li>elfordulási jeladó</li>
            <li>fordulat jeladó</li>
            <li>forgásérzékelő</li>
            <li>forgási jeladó</li>
            <li>forgó jeladó</li>
            <li>forgóadó (német hatás: r Drehgeber)</li>
          </ul>
          <p>
            A Hörmann kapuhajtás részeként nyilván találni ilyen alkatrészt, de ahhoz a garancia elvesztése nélkül nem férek hozzá, mert meg kellene bontani a készülékházat,
            ráadásul befolyásolhatja az elektronikát, ha csatlakoztatom hozzá a saját kütyümet.
          </p>
        </div>
        <div class="box-text">
          <p>
            Már egy spirálrugós tengelykapcsoló rögzítésén gondolkodtam, amikor jött az ötlet, hogy a hajtóművet a kapuval összekötő bordázott hajtószíj mozgása egyszerűen követhető a jeladó tengelyére szerelt fogaskerékkel. Mérés: a szíj bordáinak távolsága ~14.1 mm (155 mm-t mértem tolómérővel 11 bordát átfogva).
            A szíjhajtás burkolatán húzódó hosszanti rés szélessége 35 mm, ennél sokkal vaskosabb fogaskereket nehéz lenne betuszkolni. Számolás: 35×π=110, 110/14.1=7.8, a fogak száma tehát 8 legyen. 8×14.1=112.8, 112.8/π=35.9 (mm).
            Egy ilyen átmérőjű lapos henger palástjába kell mélyíteni a szíj bordáihoz illeszkedő árkokat 45 fokonként. Megoldható. Enyhíti a nyugat-balkáni nyomorúságot, amikor egy értékes dologhoz sikerül bagóért hozzájutni.
            Így esett a jeladóval, amit az ügy intézésében lelkesen résztvevő, okoskapu után epekedő megrendelő vásárolt az Ebay-en. Rögtön kettő darabot: egyet magának, egyet nekem. Alacsony összegről indult a licit, ami 2$-nál megállt. 1600 impulzust ad fordulatonként (inkrementális fajta).
            A fogaskerék 112.8 mm-es kerületével számolva ez 0.07 mm-es felbontást jelent (milliméterenként 14 impulzus), ami egy garázskapunál túlzás, de ezt adták a legolcsóbban.
          </p>            
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-fogas1.webp">
          </div>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-fogas2.webp">
          </div>
          <p>
            A műanyag fogaskerék prímán szorul a jeladó tengelyére, ragasztani sem kell. Vékony fémlemezből hajlított patent rögzítés fogja a szíjhajtás fém burkolatához, ezért könnyen felhelyezhető,
            és nehézség nélkül eltávolítható. Ez a pofonegyszerű megoldás a kapu helyzetét tizedmilliméter pontossággal méri, most már csak kezdeni kell valamit a mérőszerkezetről érkező adatokkal.
            <br>
            Miért fontos tudni, hogy pontosan hol áll a kapu? Például azért, mert ha olyan üzenet érkezik, ami nem csak a kapu elakadásáról tájékoztat, hanem a nyílás méretéről is, akkor nem rohanok haza lóhalálában,
            ha mindössze egy 3 centis rés maradt szabadon: ezen legfeljebb egy egér bújhat be (a felkutatott gyártók megoldásai nem szolgáltatnak ilyen adatot).
            A jeladóról érkező jelek feldolgozására az egyik legegyszerűbb és legolcsóbb mikroszámítógép, az Ardiuno Nano megfelelő, és a jelfeldolgozás mellett rá lehet bízni a nyers adatok további finomítását is.
          </p>            
          <figure>
            <div class="box-img">
              <img src="https://kep.pince.eu/deszka-nano.webp">
            </div>
            <figcaption>Arduino Nano</figcaption>
          </figure>
          <p>
            A feldolgozott adatokból kiderül, hol áll a kapu, esetleg mozog-e, nyílik vagy csukódik, és milyen sebességgel. Ezeket az adatokat az idő múlásának függvényében és egymáshoz képest vizsgálva észlelhető a rendellenesség, például az elakadás vagy a nyitva felejtett kapu.
            Ez így remek, csakhogy ezek az adatok mit sem érnek az Arduino belügyeként. Ki kell nyerni őket, amihez minden valamirevaló <a href="https://en.wikipedia.org/wiki/Microcontroller">MCU</a> szolgál <a href="https://hu.wikipedia.org/wiki/Univerz%C3%A1lis_aszinkron_ad%C3%B3vev%C5%91">UART</a> csatlakozással.
            A garázskapu helyzetére vonatkozó adatok az RX-TX vezetékpáron jutnak el egy vagányabb MCU-hoz (igazából egy <a href="https://hu.wikipedia.org/wiki/Egylapk%C3%A1s_rendszer">SoC</a>), egy ESP8266-hoz (a továbbiakban esp), aminek WLAN (Wi-Fi) kapcsolata révén az Arduinoból érkező adatok az internet közvetítésével kijuthatnak a nagyvilágba.
          </p>            
          <figure>
            <div class="box-img">
              <img src="https://kep.pince.eu/deszka-esp.webp">
            </div>
            <figcaption>ESP8266</figcaption>
          </figure>
          <p>
            A kapu mozgásáról gyűjtött adatok így már bárhonnan hozzáférhetők, ráadásul az esp-n futó program bizonyos feltételek teljesülésekor képes elküldeni azt az üzenetet, ami rendellenes állapotra figyelmeztet.
            A következő szükséges elektronikai alkatrész egy jelszint-átalakító, mert enélkül az 5 voltos Arduino tönkre teheti az RX-TX vonalakon rákapcsolódó 3.3 voltos esp-t.
          </p>            
          <figure>
            <div class="box-img">
              <img src="https://kep.pince.eu/deszka-level.webp">
            </div>
            <figcaption>jelszint-átalakító</figcaption>
          </figure>
          <p>
            Ezek lennének a lényegi működést megvalósító alkatrészek, amik mellett már csak egy próbapanel,
            egy tápegység és néhány vezeték szükséges a deszkamodell megépítéséhez, ami természetesen nem fog azonnal üzeneteket küldeni. Sőt, meg se nyikkan, hiszen a programozásával még nem foglalkozott senki.
            Kérdés: miért van szükség az Arduinora? Miért nem közvetlenül az esp dolgozza fel a jeladóról érkező jeleket? Jobban járok, ha nem keresem a bajt. Az esp-nek sok a dolga a <a href="https://github.com/esp8266/Arduino/blob/master/doc/reference.rst#timing-and-delays">szigorú időzítések</a>
            mellett dolgozó WLAN kapcsolat fenntartásával. Ennek okán csínján kell bánni a megszakítások tiltásával, és elegendő időt kell biztosítani a rendszer mélyén futó folyamatoknak, különben nyakamon a <i>wdt reset</i>. Időkritikus folyamatokat nem érdemes futtatni rajta,
            mert vagy az esp dob egy hátast, vagy a jeladóról sűrűn érkező jelek egy része marad feldolgozatlanul. Emiatt <a href="https://hackaday.io/project/12986-nasa-wind-decoder/log/44067-esp8266-i2c-problems">nincs implementálva esp alatt az I<sup>2</sup>C slave</a>
            módja, és <a href="https://github.com/iotpipe/esp8266-dht22#known-issues">nem érdemes használni DHT22-t</a> sem. Ezért kell közbeiktatni az Arduinot, mert az semmi mással nem foglalkozik, és elég gyors a jeladóról szaporán érkező impulzusok maradéktalan feldolgozásához.
            Így válik lehetővé a kapu mozgásának kihagyások nélküli, pontos követése. Az Arduino teljesítményébe belefér a nyers adatok előkészítése, ezzel is tehermentesítve az esp-t.
            <br><br>
            <b>3. költségvetés</b> (forrás: ebay.com)
          </p>
          <ul>
            <li>rotary encoder 2$</li>
            <li>fogaskerék (műanyag hulladék)</li>
            <li>tartólemez (fémhulladék)</li>
            <li>Arduino Nano 1-2$</li>
            <li>ESP8266 2$</li>
            <li>próbapanel 1.5$</li>
            <li>5V tápegység 2$</li>
            <li>vezetékek 1$</li>
          </ul>
          <p>
            Összeadtam, kereken 11$ (nagyjából 3200Ft), ami a postaköltséget is tartalmazza, és néhány hét várakozás után megérkeznek a csomagok. Szerencsés esetben ezek az alkatrészek fellelhetők az itthoni készletben, és már bele is vághatok.
            Nem az összeállítás és a vezetékezés fogja rabolni a legtöbb időt, ez már az elején sejthető. Az eszköztől kívánt működést leíró program megfogalmazása lesz időigényes. Sok múlik a tervezésen, ezért hasznos már az elején tudni, hogy milyen szolgáltatásokra van/lehet igény.
            Nem kellően átgondolt elképzelés mellett sajnos menet közben többször újra kell kezdeni a munkát. Ezért kezdetnek néhány napig csak a lehetőségeken rágódok, amihez számítógép sem kell, csak elegendő fantázia.
            <br><br>
            <b>4. programterv</b>
            <br>
            Nem lesz ebből <a href="http://progalapfsz.elte.hu/downloads/seged/eTananyag/lecke4_lap1.html#hiv4">Jackson-ábra</a>. Akinek nem alakul ki a fejében a feladat megoldásához szükséges elképzelés, az hiába rajzolgat.
            Ha meg benne van a fejemben, akkor rajzolgatásra semmi szükség. Ezek az ábrák akkor válnak fontossá, amikor az ember vizsgára készül, vagy a főnökének, esetleg az ügyfélnek készít dokumentációt, ami rendkívül tudományos jelleget kölcsönöz a legjelentéktelenebb munkának is.
            Erre nincs szükségem, ezért elegendően erős terv a kívánt szolgáltatások és/vagy az ezek mögött álló eljárások-metódusok felsorolása. Ez arra is jó, hogy menet közben kihúzogathatom belőle az elkészült tételeket, így nem felejtek el semmit – akár egy bevásárlólista. Arduino feladatai:
            <br>
          </p>
          <ul>
            <li>jeladó impulzusainak előjelhelyes feldolgozása (rotaryCnt)</li>
            <li>nyílásméret számolása rotaryCnt-ből</li>
            <li>kapuállapot meghatározása nyers adatokból (áll, csukódik stb.)</li>
            <li>esp-ről érkező parancsok feldolgozása: config, adatkérés, reset</li>
            <li>kapuállapot adatainak küldése esp-re (JSON)</li>
          </ul>
          <p>
            A számítógép sajátosságaihoz igazodva a kapu különböző állapotait bitek fogják tükrözni. Ebből már szinte gyerekjáték az esetleges elakadás jelenségét felismerni, de adódhatnak buktatók, amiknek megjelenésekor erősebben kell kapaszkodni a billentyűzetbe. Így néz ki az állapotot jelző bitek definíciója:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-nano1.webp">
          </div>
          <p>
            Nem árulkodik mindenről a kapu pillanatnyi állapota. A helyzet hibátlan kiértékeléséhez szükség van az előzményekre, ezért az állapotot jellemző adatokat folyamatosan tárolni kell, hogy a <i>mihez képest?</i> kérdésre is legyen válasz:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-nano2.webp">
          </div>
          <p>
            A végállásban gumi ütközőnek feszülő kapu a rá ható erő megszűnésekor visszafele mozdul, ami irányváltásnak is tűnhet. Ennek kivédésére is szolgál a 18. sorban lévő vizsgálat. Általában igaz, hogy elegendő adat híján nem lehet jó döntést hozni.
            Nem esik ebbe a hibába az Arduino, mert a szorgalmasan gyűjtött előzményadatokból képes egyszerű következtetéseket levonni, amiből a kapu elakadására is fény derülhet:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-nano3.webp">
          </div>
          <p>
            Ebben a programrészletben feltűnik egy új fogalom, az <i>érzékelési küszöb</i>. Ez azt az elmozdulást jelenti, aminél hosszabb utat kell megtennie a kapunak ahhoz, hogy a változással foglalkozzak. Ezzel a program működése higgadtabbá válik,
            és a túlzottan érzékeny jeladó kóbor impulzusai sem okoznak kavarodást. Egy kicsit előreszaladva ide teszek egy képernyőmentést a böngészőről, ami az esp-ben futó webszerverről letöltött, a kapu állapotának kiértékelésében szerepet játszó tényezők beállítását intéző HTML oldalt mutatja:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-tanit.webp">
          </div>
          <p>
            A helyzetelemző algoritmus helyes működéséhez szükség van a jeladó számlálójának a zárt állapothoz tartozó nullázására (<i>jegyez - csukva</i>), szintúgy a teljesen nyitott állapotra jellemző értékre (<i>jegyez - nyitva</i>),
            míg a pályahossz szerepet játszik a jeladó impulzusainak hosszmértékre váltásában, továbbá tényező a kapu mozgásának grafikus ábrázolásánál és a nyílásméret %-os mértékének megállapításakor.
            Izgalmat visz a képletbe a <a href="https://commons.wikimedia.org/wiki/File%3AGarage_door_opener.jpg">szekcionált garázskapu</a>, mert ennek mozgása pályájának elején nem mutat lineáris összefüggést a jeladóról érkező impulzusokkal, ezért a nyílásméret számolása is bonyolódik:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-kanyar.webp">
          </div>
          <p>
            A bonyolított képlettel elkerülhetem a kínos magyarázkodást, hogy a valóságban másfél centis nyílásnál a program miért mutat 20-at? Az Arduino figyeli a kapu mozgását, szorgalmasan gyűjti és kiértékeli az adatokat,
            amiket praktikusan JSON formába öntve el kell juttatni az esp-re. Azért pont JSON, mert ezek az adatok aztán majd mennek tovább, és egyszer egy böngészőben futó JavaScript hatókörébe kerülnek. A JavaScript pedig szereti a JSON-t. Az ember is szereti, mert egyszerűen olvasható:
            <br>
            <code>{"?":"12", "v":"0", "mm":"1118", "%":"55", "enc":"18951", "ph":"2228", "kb":"19", "max":"31830", "req":"26996"}</code>
            <br>
            Értelmezése: kapuállapot:12, sebesség:0, nyílásméret:1118 (mm), nyílás százalékban:55, jeladóról érkezett impulzusok száma:18951, pályahossz:2228 (mm), érzékelési küszöb:19 (mm), teljes nyitásnál számolt impulzus:31830, az Arduinoról az esp-re küldött adatcsomagok száma:26996.
            Kezemben az összes adat és helyzetértékelés, most már csak annyi a dolgom, hogy az eredményhez szélesebb körnek biztosítsak hozzáférést. Ez már az ESP8266 feladata lesz, a következő funkciókat megvalósítva és összehangolva:
          </p>
          <ul>
            <li>UART kapcsolat az Arduinoval</li>
            <li>riasztás (email, push üzenet)</li>
            <li>WEB szerver a böngészős kezelőfelület működtetéséhez</li>
            <li>FTP szerver a HTML oldalak karbantartásához</li>
            <li>kapu- és rendszeresemények naplózása</li>
            <li>pontos idő (NTP)</li>
            <li>működési jellemzők beállítása, tárolása</li>
            <li>rendszerparaméterek folyamatos figyelése</li>
            <li>távvezérlés</li>
          </ul>
          <p>
            Ha lúd, legyen kövér, de ez csak az egyik oka a távvezérlés megjelenésének. A másik oka a kapuhoz való távvezérlők horribilis ára: nem átallanak 70 €-t kérni egy kis vacakért. A kapuhajtáshoz telepítendő rádióvevő meg 100 €, ha nincs beépítve gyárilag,
            de ez csak a borsos áron kapható Hörmann távirányítókkal működik. Ha ezt a funkciót is beleszövöm a végeredménybe, akkor többet nem sarcolnak meg ilyen irdatlan összeggel.
            Ennek töredékéből kiegészítem a kezdeti költségvetést néhány jelfogóval vagy elektronikus kapcsolóval, a böngészős kezelőfelületen pedig elhelyezem a megfelelő gombokat:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-kezelo.webp">
          </div>
          <p>
            A távvezérlő gombok fölött a korábbi JSON példa adatai jelennek meg. Az állapot a "?":"12" kulcs:adat párból fakad. A decimális értelmezés szerint megjelenő 12 által képviselt bitek állásának megfelelően egy JavaScript funkció felelős a kapu állapotának szöveges megfogalmazásáért:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-allapot.webp">
          </div>
          <p>
            A gombok nyomkodása egyszerűen és rugalmasan kezelhető úgy a HTML/JavaScript oldalon,
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-gomb.webp">
          </div>
          <p>
            mint az esp-be megérkezett kérés:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-keres.webp">
          </div>
          <p>
            Az előző kódrészletben látható, hogy a gomb megnyomása paramétereivel együtt a naplóba kerül. Egy Sztálinnak tulajdonított mondás szerint <cite>"a bizalom alapja a szoros ellenőrzés"</cite>. Ki tudhatja azt előre, hogy szükség lesz-e valaha a családtagok tevékenységének utólagos elemzésére, hogy mikor mozgolódtak a garázsban?
            <br><br>
            A fejlesztés és kísérletezés vége felé járva egy univerzális keretrendszer felé kalandoztam el, amiben kényelmesen működtethetők olyan specifikus funkciók, mint az eredetileg vágyott riasztás a nyitva maradt kapu esetében. A gyengécske ESP8266 remekül boldogul minden feladattal,
            kivéve a titkosított csatornán megnyitott HTTP kapcsolatot, s ez a szűk keresztmetszet lehetetlenné teszi email küldését <i>rendes</i> levelezőszerverekre. Összességében a HTTPS kapcsolatot igénylő webes szolgáltatások elérése bizonytalan. Hál' istennek a garázskapu rendellenes működéséről tudósító üzenet nem minősített adat,
            ezért nem fog fájni senkinek, ha egy titkosítatlan kapcsolaton, egy közvetítő szolgáltatón át jut el rendeltetési helyére. A <a href="https://www.pushingbox.com/">PushingBox</a>-ot választottam, aminek számos előnye mellett annyi hátrányát látom, hogy ha befuccsol (mert ingyenes), akkor másikat kell keresni a pótlására.
            Közreműködésével a tervezett email és <i>push üzenet</i> mellett akár Twitteren is megoszthatom követőimmel a híreket. A kiválasztott üzenetfajtához csatolt scenario-ban leírt üzenet indítása az api.pushingbox.com-ra küldött DeviceID-vel kezdeményezhető. A különböző esetekhez rendelt riasztásokhoz így az esp-ben elegendő a PushingBox DeviceID-t tárolni:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-riaszt.webp">
          </div>
          <p>
            Nagyon barátságos megoldás, hogy a PushingBox scenario-ban változókat határozhatok meg, amikbe a riasztáskor elküldött DeviceID-hez ragasztott értékek behelyettesítődnek. A következő kódrészlet az esp-ben fut, az Arduino Nano-ról érkező adatokat dolgozza fel,
            és a feltételek teljesülésekor a PushingBox sima HTTP-n elérhető szolgáltatását hívva küldi a DeviceID-vel hivatkozott scenario-ban meghatározott üzenetet:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-uzenet.webp">
          </div>
          <p>
            Az eseményeket rögzítő naplósorok alapesetben az esp flash memóriájában kapnak helyet. Saját kíváncsiságomat elégítettem ki annak a teljesen szükségtelen programrésznek beépítésével, ami a naplóadatokat kívánságra egy <a href="https://www.google.com/intl/hu_hu/docs/about/">Google Dokumentumba</a> is elküldi.
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-config.webp">
          </div>
          <p>
            Ez a művelet egy garázskapu mozgásával összefüggésben keletkező adathalmaznál nem indokolt, de adódhatnak ennél izgalmasabb alkalmazások is, ahol a készülék eltűnése-megsemmisülése esetére is készülve, a Google Drive-on tárolt adatok megmaradnak. A Google oldalán egy rövid script doGet(e) funkciója fogadja az esp-ből küldött naplósort:
          </p>
          <div class="box-img">
            <img src="https://kep.pince.eu/deszka-gnaplo.webp">
          </div>
          <p>
            Látszik a kínlódás nyoma. Lehet igyekezni, néha érdemes is, de ez esetben az esp - ehhez a feladathoz mérten - gyér teljesítménye miatt kudarcra volt ítélve a próbálkozás. Valamennyi idő óhatatlanul pocsékba megy a zsákutcába jutott kísérletek miatt, de ez elenyésző ahhoz az előnyhöz képest,
            amit a nyílt forráskód szellemében dolgozó fejlesztői közösség, az internet közvetítésével szabadon elérhető programkönyvtárak és mások által már kidolgozott megoldások, eszközök biztosítanak. Nélkülük nem vágtam volna bele:
          </p>
          <ul>
            <li><a href="http://www.arduino.cc/">Arduino</a></li>
            <li><a href="https://github.com/esp8266/Arduino">ESP8266 core for Arduino</a></li>
            <li><a href="https://github.com/nailbuster/myWebServer">myWebServer library for esp8266</a></li>
            <li><a href="https://github.com/nailbuster/esp8266FTPServer">Simple FTP Server for esp8266 SPIFFs</a></li>
            <li><a href="https://github.com/bblanchon/ArduinoJson">JSON library for embedded systems</a></li>
            <li><a href="https://espressif.com/en/support/explore/sample-codes">Espressif Sample Codes</a></li>
            <li><a href="https://www.pushingbox.com/">PushingBox</a></li>
            <li><a href="http://neilkolban.com/tech/esp8266/">Kolban’s book on the ESP8266</a></li>
            <li><a href="https://github.com/DeqingSun/ESP8266-Dash-Button">Open sourced WiFi Button</a></li>
            <li><a href="https://github.com/tzapu/WiFiManager">ESP8266 WiFi Connection manager</a></li>
            <li><a href="https://github.com/jdfreder/pingjs">JavaScript client side ping API</a></li>
            <li><a href="https://github.com/IanLunn/Hover">CSS3 powered hover effects</a></li>
            <li><a href="http://codepen.io">playground for the front end web</a></li>
            <li><a href="http://www.allaboutcircuits.com/projects/how-to-use-a-rotary-encoder-in-a-mcu-based-project/">Rotary Encoder in an MCU-Based Project</a></li>
            <li><a href="http://stackoverflow.com/">stackoverflow</a></li>
            <li><a href="https://www.iconfinder.com/">Iconfinder</a></li>
            <li><a href="https://code.visualstudio.com/">Visual Studio Code</a></li>
            <li><a href="https://www.google.com/intl/hu_hu/docs/about/">Google</a></li>
          </ul>
        </div>
      </div>
      <div class="box">
        <div class="box-text">
          <p>
            A "cucc" elkészült, prímán működik. Gyerekbetegségeiből kigyógyulva immár hibátlan: böngészőből ellenőrizhető a kapu helyzete, vezérelhető mozgása. Naplózza az eseményeket, és küldi az üzeneteket, ha ezt követeli meg a helyzet.
            A riasztást kiváltó események között előrelátóan elhelyeztem a <i>nyitás</i> opciót is. Ez ugyan nem rendkívüli esemény, de nagyon hasznos lehet, ha belefeledkezem valamibe, és nem venném észre az asszony érkezését.
            Ilyenkor egy időben kapott jelzés életet menthet. Lehetőséget ad arra, hogy a napközben felgyülemlett ledér nőket sebtiben kituszkoljam a hátsó ajtón, akik a kerten át menekülhetnek. Néhány szanaszéjjel hagyott harisnyát és hajcsatot még meg lehet magyarázni,
            de a kipirult orcájú, csapzott nőket már nehezebben. Ebből következően az okoskapu nem csupán hasznos, hanem nélkülözhetetlen kelléke egy korszerű, vidéki háztartásnak. A munkát megelőző költségvetés ennek fényében értelmetlen,
            és a megtérülést sem érdemes feszegetni. Felbecsülhetetlen értékű eszköz.
          </p>
        </div>
        <div class="box-text-update">
          <p>
            A legutóbbi megállapítást alátámasztja az is, hogy egyedi darabról van szó, mert a fejlesztés megrekedt a működő deszkamodellnél. Megmutattam néhány érdeklődőnek, akik elégedetten vették tudomásul, hogy mennyi tudományt bele lehet préselni ezekbe az apró eszközökbe, de lelkesedésük nem fajult tettlegességgé.
            <br>
            Különössé teszi a történetet az a megdöbbentő jelenség, hogy a megrendelő nem jutott el odáig, hogy a kész prototípus alapján készítsen magának egy példányt.
            Így aztán nem is szerelte fel, és kénytelen továbbra is elszenvedni garázskapujának misztikus működéséből eredő nyitva maradásokat.
          </p>
        </div>
      </div>
      <div id="2025-03-17" alcim="közben eltelt egy évtized"><p>Közben eltelt kereken egy évtized&#8230;</p></div>
      <div class="box">
        <div class="box-text">
          <p>
            &#8230;és sokat változott a világ. 2016 áprilisában szereltem fel a működő prototípust, ami akkor funkciógazdagságával hiánypótló volt.
            Ma már a Hörmann is kínál megoldást a kapu helyzetének kényelmes lekérdezésére. Reklámszövegük szerint <cite>"nem kell többé szélben és esőben az ajtó előtt megvárnia, hogy kapuja valóban bezáródott-e. Gombnyomásra jelzi a HS 5 BS kéziadón a LED színe a kapupozíciót"</cite>.
            Nem próbáltam a terméket, de azt kell feltételeznem, hogy csak a kapu közelében használható, mert a 868 MHz-es frekvencián működő BiSecur rádiórendszer 30-50 méteres hatótávolságon belül működik.
            Nem működik már a 2016-os történetben hivatkozott <i>Hörmann Bisecur GW</i> weboldalára hivatkozó link sem, helyette itt van a <a href="https://www.hormann.hu/fileadmin/_country/kataloge/pdf/86971-BiS-SmartHome-HU.pdf">BiSecur SmartHome</a>.
            <br>
            Utólag úgy értékelem, hogy jót tett velem az ismerősöm, akinek vágya nyomán a maszek kapufelügyeleti rendszert megterveztem, és deszkamodellként létrehoztam.
            Nagyon hasznos volt ez a munka annak ellenére, hogy egy fillér bevételt nem hozott, miután az elkészült megoldást a végén senki nem használta. Más szemlélet szerint viszont gazdagodtam belőle, mert kivitelezése során rengeteg ismeretet és tapasztalatot gyűjtöttem.
            Talán ez segített abban, hogy gyereknevelési rendeltetésem vége felé visszatérhettem eredeti szakmámhoz, és most nem vagyok olyan aggasztó mértékben tájékozatlan, mint amennyire <a href="/olv/igykeszult/magad.html#profil">két évtized kihagyása</a> után lehetnék.
            <br>
            Ebbe a naprakész ismereteket követelő szakmába, a számítógépes szakterületre olyan értelemben már soha nem fogok visszatérni, hogy ezzel jövedelmet termeljek.
            A frissen tartott szakértelmet kizárólag saját igényeim kielégítésére használom, aminek csupán annyi előnyét látom, hogy nem kell idegen szakemberek bénázása és fantáziátlansága miatt bosszankodnom,
            és nem is szegényedek el abban, hogy horribilis bért fizetek nekik. Mérhetetlen nyugalmat biztosít ez a helyzet.
          </p>
        </div>
      </div>
      <div class="box-text">
        <p><a name="kovetkezo"></a></p>
      </div>
    </div>
    <div class="footer"></div>
  </section>    
</body>
</html>
<script src="/temak.js"></script>
<script src="/fejezetek.js"></script>